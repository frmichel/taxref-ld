@prefix xrr:    <http://i3s.unice.fr/xr2rml#> .
@prefix rr:     <http://www.w3.org/ns/r2rml#> .
@prefix rml:    <http://semweb.mmlab.be/ns/rml#> .

@prefix xsd:    <http://www.w3.org/2001/XMLSchema#> .
@prefix dct:    <http://purl.org/dc/terms/> .
@prefix skos:   <http://www.w3.org/2004/02/skos/core#>.
@prefix rdfs:   <http://www.w3.org/2000/01/rdf-schema#>.
@prefix rdf: 	<http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix owl:    <http://www.w3.org/2002/07/owl#>.
@prefix foaf:   <http://xmlns.com/foaf/0.1/>.

@prefix dwciri:	<http://rs.tdwg.org/dwc/iri/>.
@prefix wdt:	<http://www.wikidata.org/entity/>.
@prefix bibo:	<http://purl.org/ontology/bibo/> .

@prefix taxrefstatus: 	<http://taxref.mnhn.fr/lod/status/>.
@prefix taxrefprop:		<http://taxref.mnhn.fr/lod/property/>.


#============================= Representation of all possible status types ==================================
# Status types for legal documents:
# - Status types in group "Conventions internationales": instances of taxrefstatus:InternationalConvention
# - Status types in group "Directives européennes": taxrefstatus:EuropeanDirective
# - Status types in group "Protection": instances of taxrefstatus:Protection.
# - Status types in group "Réglementation": instances of taxrefstatus:Regulation
#
# Classes InternationalConvention, EuropeanDirective, Protection and Regulation
# are subclasses of bibo:Document.
#
# Status types in group "Liste rouge": instances of skos:Concept with skos:broader taxrefstatus:RedList.
#
# Status types in other groups (SENSIBILITE, Plan national, ZNIEFF, SCAP, etc.) are not considered.

<#TM_International_Conventions>
    a rr:TriplesMap;
    xrr:logicalSource [ xrr:query """db.statusTypes.find( {group: 'Conventions internationales'} )""" ];
    rr:subjectMap [
        rr:template "http://taxref.mnhn.fr/lod/status/{$.id}";
        rr:class taxrefstatus:InternationalConvention;
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:isDefinedBy;
        rr:objectMap [ rr:constant <http://taxref.mnhn.fr/lod/taxref-ld/{{TAXREFVER}}>; rr:termType rr:IRI ];
    ];
	rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [ xrr:reference "$.name"; rr:datatype xsd:string; rr:language "fr" ];
    ].

<#TM_EuropeanDirectives>
    a rr:TriplesMap;
    xrr:logicalSource [ xrr:query """db.statusTypes.find( {group: 'Directives européennes'} )""" ];
    rr:subjectMap [
        rr:template "http://taxref.mnhn.fr/lod/status/{$.id}";
        rr:class taxrefstatus:InternationalConvention;
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:isDefinedBy;
        rr:objectMap [ rr:constant <http://taxref.mnhn.fr/lod/taxref-ld/{{TAXREFVER}}>; rr:termType rr:IRI ];
    ];
	rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [ xrr:reference "$.name"; rr:datatype xsd:string; rr:language "fr" ];
    ].

<#TM_Protection>
    a rr:TriplesMap;
    xrr:logicalSource [ xrr:query """db.statusTypes.find( {group: 'Protection'} )""" ];
    rr:subjectMap [
        rr:template "http://taxref.mnhn.fr/lod/status/{$.id}";
        rr:class taxrefstatus:Protection;
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:isDefinedBy;
        rr:objectMap [ rr:constant <http://taxref.mnhn.fr/lod/taxref-ld/{{TAXREFVER}}>; rr:termType rr:IRI ];
    ];
	rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [ xrr:reference "$.name"; rr:datatype xsd:string; rr:language "fr" ];
    ].

<#TM_Regulation>
    a rr:TriplesMap;
    xrr:logicalSource [ xrr:query """db.statusTypes.find( {group: 'Réglementation'} )""" ];
    rr:subjectMap [
        rr:template "http://taxref.mnhn.fr/lod/status/{$.id}";
        rr:class taxrefstatus:Regulation;
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:isDefinedBy;
        rr:objectMap [ rr:constant <http://taxref.mnhn.fr/lod/taxref-ld/{{TAXREFVER}}>; rr:termType rr:IRI ];
    ];
	rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [ xrr:reference "$.name"; rr:datatype xsd:string; rr:language "fr" ];
    ].

<#TM_RedList>
    a rr:TriplesMap;
    xrr:logicalSource  [ xrr:query """db.statusTypes.find( {group: 'Liste rouge'} )""" ];
    rr:subjectMap [
        rr:template "http://taxref.mnhn.fr/lod/status/{$.id}";
        rr:class skos:Concept;
    ];
    rr:predicateObjectMap [
        rr:predicate skos:inScheme;
        rr:objectMap [ rr:constant <http://taxref.mnhn.fr/lod/taxref-ld/{{TAXREFVER}}>; rr:termType rr:IRI ];
    ];
	rr:predicateObjectMap [
        rr:predicate skos:prefLabel;
        rr:objectMap [ xrr:reference "$.name"; rr:datatype xsd:string; rr:language "fr" ];
    ];
	rr:predicateObjectMap [
        rr:predicate skos:broader;
        rr:objectMap [ rr:constant taxrefstatus:RedList; rr:termType rr:IRI ];
    ].

#================================= Representation of all possible status values =============================
# - Status values in groups Conventions internationales, Directives européennes, Protection and Réglementation
#   are instances of the class bibo:DocumentPart.
#   They are related to:
#   - the main document (status type) with property dct:partOf
#   - the bibliographic source describing the document with property dct:source.
#
# - Red lists:
#   For well-known (internationally accepted) red lists' statuses, wikidata values are used.
#   For TAXREF-specific red list statuses (i.e. CR*, RE, RE?, etc.) new instances of class 
#   wdt:Q82673 (Conservation status) were created.
#
# - Status types in other groups (SENSIBILITE, Plan national, ZNIEFF, SCAP, etc.) are not considered

<#TM_StatusValues>
    a rr:TriplesMap;
    xrr:logicalSource [ xrr:query """db.statusCodes.find( {statusTypeGroup: { $in:  ['Réglementation', 'Protection', 'Directives européennes', 'Conventions internationales']}} )""" ];
    rr:subjectMap [
        rr:template "http://taxref.mnhn.fr/lod/status/{$.statusTypeCode}/{$.statusCode}";
        rr:class bibo:DocumentPart;
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:isDefinedBy;
        rr:objectMap [ rr:constant <http://taxref.mnhn.fr/lod/taxref-ld/{{TAXREFVER}}>; rr:termType rr:IRI ];
    ];
	rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [ xrr:reference "$.statusName"; rr:datatype xsd:string; rr:language "fr" ];
    ];
	rr:predicateObjectMap [
        rr:predicate dct:source;
        rr:objectMap [ rr:template "http://taxref.mnhn.fr/lod/bib/{$.sourceId}" ];
    ];
	rr:predicateObjectMap [
        rr:predicate dct:isPartOf;
        rr:objectMap [ rr:template "http://taxref.mnhn.fr/lod/status/{$.statusTypeCode}" ];
    ].
